<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>期刊匹配与推荐 - 期刊评价系统</title>
    <!-- 引入外部资源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- 配置Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .backdrop-blur-sm {
                backdrop-filter: blur(4px);
            }
            .card-hover {
                @apply transition-all duration-300 hover:shadow-xl hover:-translate-y-1;
            }
            .btn-primary {
                @apply bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg transition-all shadow-md hover:shadow-lg;
            }
            .btn-secondary {
                @apply bg-white hover:bg-slate-50 text-primary border border-primary px-6 py-3 rounded-lg transition-all shadow-md hover:shadow-lg;
            }
            .section-padding {
                @apply py-16 md:py-24;
            }
        }
    </style>
    
    <style>
        body {
            min-height: 100vh;
            font-family: 'Inter', system-ui, sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .nav-link {
            @apply relative px-3 py-2 text-slate-200 hover:text-white transition-colors;
        }
        .nav-link::after {
            content: '';
            @apply absolute left-0 bottom-0 w-0 h-0.5 bg-primary transition-all duration-300;
        }
        .nav-link:hover::after {
            @apply w-full;
        }
    </style>
</head>
<body class="bg-linear-to-br from-slate-50 to-slate-100 font-inter text-slate-800">
    <!-- 顶部导航栏 -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-slate-900/95 backdrop-blur-sm shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- 系统名称 -->
                <div class="flex items-center">
                    <a href="home.html" class="flex items-center space-x-2">
                        <i class="fa fa-book text-primary text-2xl"></i>
                        <div>
                            <div class="text-white font-bold text-lg">期刊评价系统</div>
                            <div class="text-xs text-slate-400">Journal Evaluation System</div>
                        </div>
                    </a>
                </div>
                
                <!-- 桌面端导航菜单 -->
                <nav class="hidden md:flex space-x-4">
                    <a href="search.html" class="nav-link font-medium text-white hover:text-yellow-300">期刊查询</a>
                    <a href="survey.html" class="nav-link text-yellow-300">个人分析</a>
                    <a href="import_analysis.html" class="nav-link text-blue-100 hover:text-yellow-300">自主导入分析</a>
                    <a href="smart_qna.html" class="nav-link text-blue-100 hover:text-yellow-300">智能问答</a>
                    <a href="profile.html" class="nav-link text-blue-100 hover:text-yellow-300">个人中心</a>
                    <a href="admin_center.html" class="nav-link text-blue-100 hover:text-yellow-300" id="admin-link" style="display: none;">管理中心</a>
                </nav>
                
                <!-- 登录入口 -->
                <div class="hidden md:block">
                    <a href="index.html" class="btn-secondary py-1.5 px-4 text-sm">登录/注册</a>
                </div>
                
                <!-- 移动端菜单按钮 -->
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-slate-200 hover:text-white">
                        <i class="fa fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 移动端导航菜单 -->
        <div id="mobile-menu" class="hidden md:hidden bg-slate-800">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="search.html" class="block px-3 py-2 rounded-md text-base font-medium text-slate-300 hover:text-white hover:bg-slate-700">期刊查询</a>
                <a href="survey.html" class="block px-3 py-2 rounded-md text-base font-medium text-yellow-300 hover:bg-slate-700">个人分析</a>
                <a href="import_analysis.html" class="block px-3 py-2 rounded-md text-base font-medium text-blue-100 hover:text-yellow-300 hover:bg-slate-700">自主导入分析</a>
                <a href="smart_qna.html" class="block px-3 py-2 rounded-md text-base font-medium text-blue-100 hover:text-yellow-300 hover:bg-slate-700">智能问答</a>
                <a href="profile.html" class="block px-3 py-2 rounded-md text-base font-medium text-blue-100 hover:text-yellow-300 hover:bg-slate-700">个人中心</a>
                <a href="admin_center.html" class="block px-3 py-2 rounded-md text-base font-medium text-blue-100 hover:text-yellow-300 hover:bg-slate-700" id="admin-link-mobile" style="display: none;">管理中心</a>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="pt-24 pb-20">
        <!-- 1. 页面标题 -->
        <section class="py-12 px-4">
            <div class="max-w-7xl mx-auto text-center">
                <h1 class="text-3xl md:text-4xl font-bold mb-6 fade-in">智能期刊匹配与推荐</h1>
                <p class="text-lg text-slate-600 max-w-3xl mx-auto fade-in">基于您的研究特点，我们为您量身推荐最适合的学术期刊</p>
                <div class="w-24 h-1 bg-primary mx-auto mt-6 rounded-full fade-in"></div>
            </div>
        </section>

        <!-- 2. 用户选择信息展示 -->
        <section class="py-12 px-4 bg-white">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-2xl font-bold mb-8 text-center fade-in">您的研究特点</h2>
                <div class="grid md:grid-cols-3 gap-6 fade-in">
                    <!-- 创新性选择 -->
                    <div id="innovation-selection" class="bg-slate-50 p-6 rounded-xl shadow-sm border border-slate-100">
                        <div class="flex items-center mb-4">
                            <div class="bg-primary/10 w-12 h-12 rounded-full flex items-center justify-center mr-4">
                                <i class="fa fa-lightbulb-o text-2xl text-primary"></i>
                            </div>
                            <h3 class="text-xl font-semibold">创新性</h3>
                        </div>
                        <p id="innovation-result" class="text-slate-700">选择：<span class="font-medium text-primary">待加载...</span></p>
                    </div>

                    <!-- 学科性选择 -->
                    <div id="discipline-selection" class="bg-slate-50 p-6 rounded-xl shadow-sm border border-slate-100">
                        <div class="flex items-center mb-4">
                            <div class="bg-secondary/10 w-12 h-12 rounded-full flex items-center justify-center mr-4">
                                <i class="fa fa-book text-2xl text-secondary"></i>
                            </div>
                            <h3 class="text-xl font-semibold">学科性</h3>
                        </div>
                        <p id="discipline-result" class="text-slate-700">选择：<span class="font-medium text-secondary">待加载...</span></p>
                    </div>

                    <!-- 主题性选择 -->
                    <div id="theme-selection" class="bg-slate-50 p-6 rounded-xl shadow-sm border border-slate-100">
                        <div class="flex items-center mb-4">
                            <div class="bg-accent/10 w-12 h-12 rounded-full flex items-center justify-center mr-4">
                                <i class="fa fa-tags text-2xl text-accent"></i>
                            </div>
                            <h3 class="text-xl font-semibold">主题性</h3>
                        </div>
                        <p id="theme-result" class="text-slate-700">选择：<span class="font-medium text-accent">待加载...</span></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. 用户画像介绍 -->
        <section class="py-16 px-4 bg-linear-to-br from-primary/5 to-accent/5">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-2xl font-bold mb-8 text-center fade-in">研究画像分析</h2>
                <div class="bg-white rounded-2xl shadow-lg p-8 fade-in">
                    <div class="flex items-center mb-6">
                        <div class="bg-primary/10 w-16 h-16 rounded-full flex items-center justify-center mr-6">
                            <i class="fa fa-user-circle text-3xl text-primary"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold">研究者画像</h3>
                            <p class="text-slate-600">基于AI分析生成的个性化研究画像</p>
                        </div>
                    </div>
                    <div id="user-profile" class="space-y-4 text-slate-700">
                        <p>正在生成您的研究画像... 基于您提供的信息，我们的AI系统正在分析您的研究特点并创建个性化画像。</p>
                        <div class="w-full bg-slate-200 rounded-full h-2.5">
                            <div class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. 期刊匹配与推荐 -->
        <section class="py-16 px-4 bg-white">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-2xl font-bold mb-8 text-center fade-in">推荐期刊</h2>
                <div id="journal-recommendation" class="bg-linear-to-r from-slate-50 to-slate-100 rounded-2xl shadow-lg overflow-hidden fade-in">
                    <!-- 期刊封面和基本信息 -->
                    <div class="md:flex">
                        <div class="md:w-1/3 bg-linear-to-br from-primary to-accent p-8 text-white flex items-center justify-center">
                            <div class="text-center">
                                <div class="w-40 h-40 mx-auto bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center mb-4">
                                    <i class="fa fa-book text-6xl text-white"></i>
                                </div>
                                    <h3 class="text-2xl font-bold mb-2" id="main-journal-title">待推荐期刊</h3>
                                    <div class="flex items-center justify-center mb-2">
                                        <span class="inline-block bg-white/80 text-primary font-bold rounded-full px-4 py-1 text-lg shadow-sm" id="main-journal-score-label">
                                            推荐指数 <span id="main-journal-score" class="ml-1">0</span>
                                        </span>
                                    </div>
                                    <p class="text-white/80">基于您的研究特点</p>
                            </div>
                        </div>
                        <div class="md:w-2/3 p-8">
                            <div class="grid md:grid-cols-2 gap-6">
                                <!-- 期刊基本信息 -->
                                <div>
                                    <h4 class="text-lg font-semibold mb-4 text-slate-800">期刊信息</h4>
                                    <ul class="space-y-3">
                                        <li class="flex items-start">
                                            <i class="fa fa-id-card text-primary mt-1 mr-3"></i>
                                            <div>
                                                <span class="font-medium text-slate-700">期刊名称：</span>
                                                <span id="journal-name" class="text-slate-600">待推荐</span>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <i class="fa fa-flask text-primary mt-1 mr-3"></i>
                                            <div>
                                                <span class="font-medium text-slate-700">学科领域：</span>
                                                <span id="journal-discipline" class="text-slate-600">待推荐</span>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <i class="fa fa-line-chart text-primary mt-1 mr-3"></i>
                                            <div>
                                                <span class="font-medium text-slate-700">影响因子：</span>
                                                <span id="journal-impact" class="text-slate-600">待推荐</span>
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <i class="fa fa-clock-o text-primary mt-1 mr-3"></i>
                                            <div>
                                                <span class="font-medium text-slate-700">出版周期：</span>
                                                <span id="journal-frequency" class="text-slate-600">待推荐</span>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <!-- 匹配度信息 -->
                                <div>
                                    <h4 class="text-lg font-semibold mb-4 text-slate-800">匹配分析</h4>
                                    <div class="space-y-4">
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span class="text-sm font-medium text-slate-700">整体契合度</span>
                                                <span id="match-percentage" class="text-sm font-medium text-primary">0%</span>
                                            </div>
                                            <div class="w-full bg-slate-200 rounded-full h-2.5">
                                                <div id="match-progress" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span class="text-sm font-medium text-slate-700">创新性匹配</span>
                                                <span id="innovation-match" class="text-sm font-medium text-secondary">0%</span>
                                            </div>
                                            <div class="w-full bg-slate-200 rounded-full h-2.5">
                                                <div id="innovation-progress" class="bg-secondary h-2.5 rounded-full" style="width: 0%"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span class="text-sm font-medium text-slate-700">学科匹配</span>
                                                <span id="discipline-match" class="text-sm font-medium text-accent">0%</span>
                                            </div>
                                            <div class="w-full bg-slate-200 rounded-full h-2.5">
                                                <div id="discipline-progress" class="bg-accent h-2.5 rounded-full" style="width: 0%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 期刊核心值 -->
                    <div class="p-8 border-t border-slate-200">
                        <h4 class="text-lg font-semibold mb-6 text-slate-800">期刊核心值</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <div class="text-sm font-medium text-slate-700 mb-2">新颖性</div>
                                <div class="text-2xl font-bold text-blue-600" id="novelty-value">0</div>
                                <div class="h-2 bg-blue-200 rounded-full mt-2">
                                    <div id="novelty-bar" class="h-2 bg-blue-500 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                <div class="text-sm font-medium text-slate-700 mb-2">颠覆性</div>
                                <div class="text-2xl font-bold text-purple-600" id="disruptiveness-value">0</div>
                                <div class="h-2 bg-purple-200 rounded-full mt-2">
                                    <div id="disruptiveness-bar" class="h-2 bg-purple-500 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <div class="text-sm font-medium text-slate-700 mb-2">跨学科性</div>
                                <div class="text-2xl font-bold text-green-600" id="interdisciplinarity-value">0</div>
                                <div class="h-2 bg-green-200 rounded-full mt-2">
                                    <div id="interdisciplinarity-bar" class="h-2 bg-green-500 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                                <div class="text-sm font-medium text-slate-700 mb-2">主题复杂度</div>
                                <div class="text-2xl font-bold text-orange-600" id="themeComplexity-value">0</div>
                                <div class="h-2 bg-orange-200 rounded-full mt-2">
                                    <div id="themeComplexity-bar" class="h-2 bg-orange-500 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 雷达图分析 -->
                    <div class="p-8 border-t border-slate-200">
                        <h4 class="text-lg font-semibold mb-6 text-center text-slate-800">期刊多维度分析</h4>
                        <div class="flex flex-col md:flex-row items-center justify-center gap-8">
                            <div class="w-full md:w-1/2 h-80">
                                <canvas id="journalRadarChart"></canvas>
                            </div>
                            <div class="w-full md:w-1/2">
                                <h5 class="text-md font-semibold mb-4 text-slate-800">近期研究主题</h5>
                                <div id="recent-topics" class="space-y-2">
                                    <div class="bg-slate-100 px-4 py-2 rounded-lg text-slate-700 flex items-center">
                                        <i class="fa fa-circle text-xs text-primary mr-2"></i>
                                        <span>待加载近期研究主题...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI分析说明 -->
                    <div class="p-8 bg-slate-50 border-t border-slate-200">
                        <div class="flex items-center mb-4">
                            <i class="fa fa-robot text-2xl text-primary mr-3"></i>
                            <h4 class="text-lg font-semibold text-slate-800">AI匹配分析说明</h4>
                        </div>
                        <div id="ai-analysis" class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 text-slate-700">
                            <p>正在生成AI分析... 我们的智能系统正在分析您的研究特点与期刊的契合度。</p>
                            <div class="w-full bg-slate-200 rounded-full h-2.5 mt-4">
                                <div class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <!-- 更多推荐卡片区 -->
                    <div id="journal-more-recommendation" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mt-10"></div>
                </div>
            </div>
        </section>

        <!-- 5. 行动按钮 -->
        <section class="py-12 px-4 text-center">
            <div class="max-w-7xl mx-auto">
                <div class="flex flex-col sm:flex-row justify-center gap-4 fade-in">
                    <button id="save-recommendation" class="btn-primary">
                        <i class="fa fa-download mr-2"></i>保存推荐报告
                    </button>
                    <a href="survey.html" class="btn-secondary">
                        <i class="fa fa-refresh mr-2"></i>重新评估
                    </a>
                    <a href="home.html#smart-qna" class="btn-secondary bg-slate-800 text-white border-slate-700 hover:bg-slate-700">
                        <i class="fa fa-comments mr-2"></i>智能问答
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-slate-900 text-slate-300 py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center space-x-2 mb-6">
                        <i class="fa fa-book text-primary text-2xl"></i>
                        <div>
                            <div class="text-white font-bold text-lg">期刊评价系统</div>
                            <div class="text-xs text-slate-400">Journal Evaluation System</div>
                        </div>
                    </div>
                    <p class="mb-6">智能分析中外期刊差异，服务"把论文写在祖国大地上"</p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-slate-400 hover:text-primary transition-colors">
                            <i class="fa fa-weibo text-xl"></i>
                        </a>
                        <a href="#" class="text-slate-400 hover:text-primary transition-colors">
                            <i class="fa fa-wechat text-xl"></i>
                        </a>
                        <a href="#" class="text-slate-400 hover:text-primary transition-colors">
                            <i class="fa fa-github text-xl"></i>
                        </a>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-white font-semibold text-lg mb-6">快速链接</h3>
                    <ul class="space-y-3">
                        <li><a href="home.html" class="hover:text-primary transition-colors">首页</a></li>
                        <li><a href="survey.html" class="hover:text-primary transition-colors">信息统计</a></li>
                        <li><a href="journal_matching.html" class="hover:text-primary transition-colors">期刊匹配</a></li>
                        <li><a href="home.html#about" class="hover:text-primary transition-colors">关于我们</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-white font-semibold text-lg mb-6">帮助支持</h3>
                    <ul class="space-y-3">
                        <li><a href="#" class="hover:text-primary transition-colors">使用指南</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">常见问题</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">隐私政策</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">联系我们</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-white font-semibold text-lg mb-6">联系我们</h3>
                    <ul class="space-y-3">
                        <li class="flex items-start">
                            <i class="fa fa-envelope text-primary mr-3 mt-1"></i>
                            <span>contact@jounral-eval.edu.cn</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-phone text-primary mr-3 mt-1"></i>
                            <span>010-12345678</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-map-marker text-primary mr-3 mt-1"></i>
                            <span>北京市海淀区中关村南大街5号</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-slate-800 mt-12 pt-8 text-center">
                <p>© 2024 基于内容的期刊评价系统. 保留所有权利.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // 移动端菜单切换
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // 从URL获取问卷数据
        function getSurveyDataFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                innovation: urlParams.get('innovation') || 'A',
                discipline: urlParams.get('discipline') || 'B',
                theme: urlParams.get('theme') || 'C'
            };
        }

        // 获取选项的中文描述
        function getOptionLabel(type, value) {
            const labels = {
                innovation: {
                    'A': '开辟新方向',
                    'B': '重大改进',
                    'C': '稳健验证'
                },
                discipline: {
                    'A': '单一学科',
                    'B': '两个学科交叉',
                    'C': '三个及以上学科融合'
                },
                theme: {
                    'A': '紧扣当前最热话题',
                    'B': '是某个长期问题的进展',
                    'C': '是一个较新的探索方向'
                }
            };
            return labels[type][value] || '未知选项';
        }

        // 显示用户选择
        function displayUserSelections() {
            const surveyData = getSurveyDataFromUrl();
            
            document.getElementById('innovation-result').innerHTML = 
                `选择：<span class="font-medium text-primary">${getOptionLabel('innovation', surveyData.innovation)}</span>`;
            
            document.getElementById('discipline-result').innerHTML = 
                `选择：<span class="font-medium text-secondary">${getOptionLabel('discipline', surveyData.discipline)}</span>`;
            
            document.getElementById('theme-result').innerHTML = 
                `选择：<span class="font-medium text-accent">${getOptionLabel('theme', surveyData.theme)}</span>`;
        }

        // 生成用户画像（模拟AI生成）
        function generateUserProfile() {
            const surveyData = getSurveyDataFromUrl();
            let profileText = '';
            
            // 根据选择生成不同的画像描述
            if (surveyData.innovation === 'A' && surveyData.discipline === 'C' && surveyData.theme === 'A') {
                profileText = `
                    <p class="mb-4">根据您的选择，我们生成了以下研究画像：</p>
                    <div class="bg-primary/5 border-l-4 border-primary p-4 rounded-r mb-4">
                        <h4 class="font-semibold text-lg text-primary mb-2">前沿交叉创新型研究者</h4>
                        <p>您是一位具有开拓精神的研究者，致力于跨学科融合，紧跟当前研究热点。您的工作具有很强的创新性和前瞻性，</p>
                    </div>
                    <ul class="list-disc list-inside space-y-2 text-slate-700">
                        <li>擅长在多学科交叉领域开辟新的研究方向</li>
                        <li>对当前学术前沿话题保持高度敏感</li>
                        <li>研究工作具有较强的创新性和颠覆性潜力</li>
                        <li>适合在高水平综合性期刊发表研究成果</li>
                    </ul>
                `;
            } else if (surveyData.innovation === 'B' && surveyData.discipline === 'B' && surveyData.theme === 'B') {
                profileText = `
                    <p class="mb-4">根据您的选择，我们生成了以下研究画像：</p>
                    <div class="bg-secondary/5 border-l-4 border-secondary p-4 rounded-r mb-4">
                        <h4 class="font-semibold text-lg text-secondary mb-2">稳健渐进型研究者</h4>
                        <p>您是一位注重扎实基础的研究者，在两个学科的交叉领域稳步推进，致力于解决长期存在的科学问题。</p>
                    </div>
                    <ul class="list-disc list-inside space-y-2 text-slate-700">
                        <li>擅长对现有方法进行系统性改进</li>
                        <li>在两个学科的交叉点找到创新机会</li>
                        <li>研究工作注重可持续性和长期价值</li>
                        <li>适合在专业领域顶级期刊发表研究成果</li>
                    </ul>
                `;
            } else {
                profileText = `
                    <p class="mb-4">根据您的选择，我们生成了以下研究画像：</p>
                    <div class="bg-accent/5 border-l-4 border-accent p-4 rounded-r mb-4">
                        <h4 class="font-semibold text-lg text-accent mb-2">探索验证型研究者</h4>
                        <p>您是一位谨慎而富有探索精神的研究者，在相对新的研究方向上进行系统性验证，为领域发展提供可靠支撑。</p>
                    </div>
                    <ul class="list-disc list-inside space-y-2 text-slate-700">
                        <li>注重研究结果的可重复性和可靠性</li>
                        <li>在新兴研究方向上进行深入探索</li>
                        <li>研究工作具有较强的实证基础</li>
                        <li>适合在专业领域高质量期刊发表研究成果</li>
                    </ul>
                `;
            }
            
            // 模拟加载过程
            setTimeout(() => {
                document.getElementById('user-profile').innerHTML = profileText;
            }, 1500);
        }

        // 推荐期刊（模拟推荐过程）
        function recommendJournal() {
            const surveyData = getSurveyDataFromUrl();
            let journalData = {};
            let moreJournals = [];
            // 主推荐
            if (surveyData.innovation === 'A' && surveyData.discipline === 'C' && surveyData.theme === 'A') {
                journalData = {
                    id: 'J001',
                    name: 'Nature Communications',
                    discipline: '多学科交叉研究',
                    impact: '17.694',
                    frequency: '周刊',
                    matchPercentage: 92,
                    innovationMatch: 95,
                    disciplineMatch: 90,
                    novelty: 85.5,
                    disruptiveness: 88.2,
                    interdisciplinarity: 92.0,
                    themeComplexity: 75.3,
                    recentTopics: ['人工智能与可持续发展', '跨学科数据科学', '全球健康创新', '新兴技术伦理']
                };
                moreJournals = [
                    {id:'J002', name:'Science Advances', impact:'14.957', discipline:'综合科学', frequency:'半月刊',
                        novelty: 83.2, disruptiveness: 80.5, interdisciplinarity: 88.1, themeComplexity: 77.3},
                    {id:'J003', name:'Cell Reports', impact:'9.995', discipline:'生命科学', frequency:'周刊',
                        novelty: 78.6, disruptiveness: 75.4, interdisciplinarity: 70.2, themeComplexity: 68.9},
                    {id:'J004', name:'Advanced Science', impact:'15.1', discipline:'材料科学', frequency:'月刊',
                        novelty: 85.0, disruptiveness: 82.7, interdisciplinarity: 80.3, themeComplexity: 72.5}
                ];
            } else if (surveyData.innovation === 'B' && surveyData.discipline === 'B' && surveyData.theme === 'B') {
                journalData = {
                    id: 'J005',
                    name: 'IEEE Transactions on Pattern Analysis and Machine Intelligence',
                    discipline: '计算机科学与人工智能',
                    impact: '24.318',
                    frequency: '月刊',
                    matchPercentage: 88,
                    innovationMatch: 85,
                    disciplineMatch: 90,
                    novelty: 72.8,
                    disruptiveness: 65.4,
                    interdisciplinarity: 68.0,
                    themeComplexity: 80.2,
                    recentTopics: ['计算机视觉前沿', '深度学习优化', '模式识别新方法', '多模态学习']
                };
                moreJournals = [
                    {id:'J006', name:'Pattern Recognition', impact:'8.518', discipline:'人工智能', frequency:'月刊',
                        novelty: 75.1, disruptiveness: 70.2, interdisciplinarity: 65.8, themeComplexity: 80.0},
                    {id:'J007', name:'Neural Networks', impact:'7.197', discipline:'神经网络', frequency:'月刊',
                        novelty: 80.3, disruptiveness: 78.9, interdisciplinarity: 72.4, themeComplexity: 76.2},
                    {id:'J008', name:'Information Sciences', impact:'8.233', discipline:'信息科学', frequency:'半月刊',
                        novelty: 77.7, disruptiveness: 74.5, interdisciplinarity: 70.0, themeComplexity: 73.8}
                ];
            } else {
                journalData = {
                    id: 'J009',
                    name: 'Journal of Information Science',
                    discipline: '信息科学与图书馆学',
                    impact: '4.852',
                    frequency: '双月刊',
                    matchPercentage: 85,
                    innovationMatch: 80,
                    disciplineMatch: 95,
                    novelty: 70.5,
                    disruptiveness: 60.0,
                    interdisciplinarity: 75.0,
                    themeComplexity: 65.3,
                    recentTopics: ['数字信息行为', '知识组织新方法', '图书馆服务创新', '信息素养教育']
                };
                moreJournals = [
                    {id:'J010', name:'Library Hi Tech', impact:'3.2', discipline:'图书馆学', frequency:'季刊',
                        novelty: 68.2, disruptiveness: 60.5, interdisciplinarity: 62.1, themeComplexity: 65.0},
                    {id:'J011', name:'Online Information Review', impact:'2.8', discipline:'信息管理', frequency:'双月刊',
                        novelty: 70.0, disruptiveness: 62.8, interdisciplinarity: 66.7, themeComplexity: 60.9},
                    {id:'J012', name:'Scientometrics', impact:'3.238', discipline:'科学计量学', frequency:'月刊',
                        novelty: 72.5, disruptiveness: 68.9, interdisciplinarity: 70.2, themeComplexity: 68.3}
                ];
            }
            // 主推荐区（原有逻辑）
            setTimeout(() => {
                // ...existing code for main journal update...
                document.getElementById('journal-name').textContent = journalData.name;
                    document.getElementById('journal-name').textContent = journalData.name;
                    document.getElementById('main-journal-title').textContent = journalData.name;
                    document.getElementById('journal-discipline').textContent = journalData.discipline;
                    document.getElementById('journal-impact').textContent = journalData.impact;
                    document.getElementById('journal-frequency').textContent = journalData.frequency;
                    animateProgressBar('match-progress', journalData.matchPercentage);
                    document.getElementById('match-percentage').textContent = `${journalData.matchPercentage}%`;
                    animateProgressBar('innovation-progress', journalData.innovationMatch);
                    document.getElementById('innovation-match').textContent = `${journalData.innovationMatch}%`;
                    animateProgressBar('discipline-progress', journalData.disciplineMatch);
                    document.getElementById('discipline-match').textContent = `${journalData.disciplineMatch}%`;
                    // 推荐指数/契合指数
                    document.getElementById('main-journal-score').textContent = journalData.matchPercentage;
                    const topicsHtml = journalData.recentTopics.map(topic => `
                        <div class="bg-slate-100 px-4 py-2 rounded-lg text-slate-700 flex items-center">
                            <i class="fa fa-circle text-xs text-primary mr-2"></i>
                            <span>${topic}</span>
                        </div>
                    `).join('');
                    document.getElementById('recent-topics').innerHTML = topicsHtml;
                    document.getElementById('novelty-value').textContent = journalData.novelty.toFixed(1);
                    document.getElementById('novelty-bar').style.width = journalData.novelty + '%';
                    document.getElementById('disruptiveness-value').textContent = journalData.disruptiveness.toFixed(1);
                    document.getElementById('disruptiveness-bar').style.width = journalData.disruptiveness + '%';
                    document.getElementById('interdisciplinarity-value').textContent = journalData.interdisciplinarity.toFixed(1);
                    document.getElementById('interdisciplinarity-bar').style.width = journalData.interdisciplinarity + '%';
                    document.getElementById('themeComplexity-value').textContent = journalData.themeComplexity.toFixed(1);
                    document.getElementById('themeComplexity-bar').style.width = journalData.themeComplexity + '%';
                    generateRadarChart(journalData);
                    generateAIAnalysis(journalData);
                    // 新增更多推荐区
                    const moreHtml = moreJournals.map(j => `
                        <div class="bg-white rounded-xl shadow p-6 card-hover border border-slate-100 cursor-pointer transition hover:border-primary" onclick="window.location.href='journal_detail.html?id=${j.id}'">
                            <div class="flex items-center mb-2">
                                <i class="fa fa-book text-primary text-2xl mr-3"></i>
                                <div class="text-lg font-bold text-slate-800">${j.name}</div>
                            </div>
                            <div class="flex items-center justify-between mb-1">
                                <div class="text-slate-600">${j.discipline}</div>
                                <span class="inline-block bg-primary/10 text-primary font-bold rounded-full px-3 py-0.5 text-sm ml-2">
                                    推荐值 <span class="ml-1">${typeof j.matchPercentage !== 'undefined' ? j.matchPercentage : (80 + Math.floor(Math.random()*15))}</span>
                                </span>
                            </div>
                            <div class="flex items-center text-sm text-slate-500 mb-1">
                                <i class="fa fa-star text-yellow-400 mr-1"></i>影响因子：${j.impact}
                            </div>
                            <div class="text-xs text-slate-400 mb-2">${j.frequency}</div>
                            <div class="grid grid-cols-2 gap-2 text-xs text-slate-600 mt-2">
                                <div class="bg-blue-50 rounded px-2 py-1 flex items-center"><span class="font-semibold text-blue-500 mr-1">新颖性</span>${j.novelty ?? '--'}</div>
                                <div class="bg-purple-50 rounded px-2 py-1 flex items-center"><span class="font-semibold text-purple-500 mr-1">颠覆性</span>${j.disruptiveness ?? '--'}</div>
                                <div class="bg-green-50 rounded px-2 py-1 flex items-center"><span class="font-semibold text-green-500 mr-1">跨学科性</span>${j.interdisciplinarity ?? '--'}</div>
                                <div class="bg-orange-50 rounded px-2 py-1 flex items-center"><span class="font-semibold text-orange-500 mr-1">主题复杂度</span>${j.themeComplexity ?? '--'}</div>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('journal-more-recommendation').innerHTML = moreHtml;
            }, 1000);
        }

        // 动画进度条
        function animateProgressBar(elementId, percentage) {
            const element = document.getElementById(elementId);
            let width = 0;
            const interval = setInterval(() => {
                if (width >= percentage) {
                    clearInterval(interval);
                } else {
                    width++;
                    element.style.width = width + '%';
                }
            }, 20);
        }

        // 生成雷达图
        function generateRadarChart(journalData) {
            // 计算前沿性 = (新颖性 + 颠覆性) / 2
            const contentFrontier = journalData.novelty && journalData.disruptiveness 
                ? ((journalData.novelty + journalData.disruptiveness) / 2).toFixed(1)
                : 85;
            
            // 获取跨学科性
            const disciplineOpenness = journalData.interdisciplinarity || 92;
            
            // 获取主题复杂度
            const themeComplexity = journalData.themeComplexity || 78;
            
            // 热点响应度随机
            const trendResponse = Math.floor(Math.random() * 40) + 60; // 60-100之间

            const ctx = document.getElementById('journalRadarChart').getContext('2d');
            
            const radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['内容前沿性', '学科开放性', '主题复杂度', '热点响应度'],
                    datasets: [
                        {
                            label: '期刊特征',
                            data: [contentFrontier, disciplineOpenness, themeComplexity, trendResponse],
                            backgroundColor: 'rgba(59, 130, 246, 0.2)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            pointBackgroundColor: 'rgba(59, 130, 246, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(59, 130, 246, 1)'
                        },
                        {
                            label: '您的研究特征',
                            data: [90, 85, 82, 78],
                            backgroundColor: 'rgba(139, 92, 246, 0.2)',
                            borderColor: 'rgba(139, 92, 246, 1)',
                            pointBackgroundColor: 'rgba(139, 92, 246, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(139, 92, 246, 1)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    }
                }
            });
        }

        // 生成AI分析说明（调用后端 AI 接口）
        // Markdown 转 HTML 的完整解析器
        function markdownToHtml(markdown) {
            if (!markdown || typeof markdown !== 'string') return '';
            
            let html = markdown;
            
            // 1. 处理代码块（``` ... ```）
            html = html.replace(/```[\s\S]*?```/g, function(match) {
                const code = match.replace(/```/g, '').trim();
                return '<pre class="bg-slate-800 text-slate-100 p-4 rounded-lg overflow-x-auto mb-3"><code class="font-mono text-sm">' + 
                       escapeHtml(code) + '</code></pre>';
            });
            
            // 2. 处理四级标题 ####
            html = html.replace(/^#### (.+?)$/gm, 
                '<h5 class="text-base font-bold text-primary mt-3 mb-2 border-l-4 border-primary pl-3">$1</h5>');
            
            // 3. 处理三级标题 ###
            html = html.replace(/^### (.+?)$/gm, 
                '<h4 class="text-lg font-bold text-slate-800 mt-5 mb-3 pb-2 border-b-2 border-primary">$1</h4>');
            
            // 4. 处理二级标题 ##
            html = html.replace(/^## (.+?)$/gm, 
                '<h3 class="text-xl font-bold text-slate-900 mt-6 mb-4">$1</h3>');
            
            // 5. 处理一级标题 #
            html = html.replace(/^# (.+?)$/gm, 
                '<h2 class="text-2xl font-bold text-slate-900 mt-7 mb-4">$1</h2>');
            
            // 6. 处理加粗 **text** 或 __text__
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong class="font-semibold text-slate-800">$1</strong>');
            html = html.replace(/__(.+?)__/g, '<strong class="font-semibold text-slate-800">$1</strong>');
            
            // 7. 处理斜体 *text* 或 _text_（但不匹配已处理的 **）
            html = html.replace(/(?<!\*)\*(?!\*)(.+?)(?!\*)\*(?!\*)/g, '<em class="italic text-slate-700">$1</em>');
            html = html.replace(/(?<!_)_(?!_)(.+?)(?<!_)_(?!_)/g, '<em class="italic text-slate-700">$1</em>');
            
            // 8. 处理行内代码 \`code\`
            html = html.replace(/`(.+?)`/g, 
                '<code class="bg-slate-100 text-red-600 px-2 py-0.5 rounded font-mono text-sm">$1</code>');
            
            // 9. 处理有序列表 1. 2. 等
            html = html.replace(/^\d+\. (.+?)$/gm, 
                '<li class="ml-6 text-slate-700 marker:text-primary">$1</li>');
            
            // 10. 处理无序列表 - 或 *
            html = html.replace(/^[\-\*] (.+?)$/gm, 
                '<li class="ml-6 text-slate-700">$1</li>');
            
            // 11. 将连续的 <li> 包装在 <ul> 或 <ol> 中
            html = html.replace(/(<li[^>]*>[\s\S]*?<\/li>\n?)+/g, function(match) {
                const isOrdered = match.includes('marker:');
                const wrapper = isOrdered ? 'ol' : 'ul';
                return '<' + wrapper + ' class="space-y-1 mb-3 list-inside">' + match.trim() + '</' + wrapper + '>';
            });
            
            // 12. 处理分割线 ---
            html = html.replace(/^---$/gm, '<hr class="border-slate-300 my-4">');
            
            // 13. 处理换行和空行
            let lines = html.split('\n');
            let result = [];
            let inList = false;
            let inCodeBlock = false;
            
            for (let line of lines) {
                line = line.trim();
                
                if (line.startsWith('<pre')) inCodeBlock = true;
                if (line.endsWith('</pre>')) inCodeBlock = false;
                
                if (inCodeBlock) {
                    result.push(line);
                } else if (line === '') {
                    // 空行处理
                    if (!inList && result.length > 0 && !result[result.length - 1].endsWith('</div>')) {
                        result.push('<div class="h-2"></div>');
                    }
                } else if (line.startsWith('<ol') || line.startsWith('<ul')) {
                    inList = true;
                    result.push(line);
                } else if (line.endsWith('</ol>') || line.endsWith('</ul>')) {
                    inList = false;
                    result.push(line);
                } else if (line.startsWith('<h') || line.startsWith('<pre') || line.startsWith('<hr')) {
                    result.push(line);
                } else if (line.startsWith('<li')) {
                    result.push(line);
                } else if (!inList && line && !line.startsWith('<') && line.length > 0) {
                    // 普通段落
                    result.push('<p class="text-slate-700 leading-relaxed mb-2">' + line + '</p>');
                } else if (line) {
                    result.push(line);
                }
            }
            
            html = result.join('\n');
            
            // 14. 清理过多的空 div
            html = html.replace(/<div class="h-2"><\/div>\n<div class="h-2"><\/div>/g, '<div class="h-2"></div>');
            
            return html;
        }
        
        // HTML 转义函数，防止 XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function generateAIAnalysis(journalData) {
            // 显示 loading 状态
            document.getElementById('ai-analysis').innerHTML = '<p>正在生成AI分析，请稍候...</p>' +
                '<div class="w-full bg-slate-200 rounded-full h-2.5 mt-4"><div class="bg-primary h-2.5 rounded-full" style="width:30%"></div></div>';

            fetch('/api/ai-analysis', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ journalData: journalData, surveyData: getSurveyDataFromUrl() })
            })
            .then(res => res.json())
            .then(data => {
                if (data && data.ok && data.html) {
                    // AI 返回的是 Markdown 格式纯文本，需要转换为 HTML
                    const htmlContent = markdownToHtml(data.html);
                    document.getElementById('ai-analysis').innerHTML = htmlContent;
                } else if (data && data.html) {
                    // 备选：如果已经是 HTML 格式
                    const htmlContent = markdownToHtml(data.html);
                    document.getElementById('ai-analysis').innerHTML = htmlContent;
                } else {
                    document.getElementById('ai-analysis').innerHTML = '<p>AI 分析生成失败，请稍后再试。</p>';
                    console.error('AI error:', data);
                }
            })
            .catch(err => {
                document.getElementById('ai-analysis').innerHTML = '<p>请求发生错误，请检查网络或稍后重试。</p>';
                console.error(err);
            });
        }

        // 保存推荐报告
        document.getElementById('save-recommendation').addEventListener('click', function() {
            alert('推荐报告已保存！（实际应用中可实现PDF导出功能）');
        });

        // 页面加载完成后执行
        window.addEventListener('load', function() {
            // 显示用户选择
            displayUserSelections();
            
            // 生成用户画像
            generateUserProfile();
            
            // 推荐期刊
            recommendJournal();
            
            // 滚动动画
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.1
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);
            
            document.querySelectorAll('section > div').forEach(section => {
                observer.observe(section);
            });
        });
    </script>
</body>
</html>